# coding=utf-8# @author   ：迷心兔# time      ：2019/11/10from django.test import TestCasefrom django.urls import resolve, reversefrom django.utils import timezonefrom ..models import Postfrom ..views import post_newfrom django.contrib.auth.models import Userfrom django.forms import ModelForm# 测试新建文章页面class NewTests(TestCase):    def setUp(self):        self.username = "mi"        self.password = "123456"        self.user = User.objects.create_user(username = self.username, password = self.password)        self.post = Post.objects.create(            author = self.user,            title = "test title",            text = "test text",            created_date = timezone.now( ),            published_date = timezone.now( ),        )        self.post_new_url = reverse('post_new')# 需要登录后的测试class LoginRequiredNewViewTests(NewTests):    # 测试失败响应码    def test_view_post_new_not_found_status_code(self):        self.response = self.client.get(self.post_new_url)        self.assertEquals(self.response.status_code, 302)    # 测试重定向操作    def test_redirection(self):        login_url = reverse('login')        response = self.client.get(self.post_new_url)        self.assertRedirects(            response,            '{login_url}?next={url}'.format(login_url = login_url, url = self.post_new_url))# 成功登陆的测试class LoginSuccessNewTests(NewTests):    def setUp(self):        super( ).setUp( )        self.client.login(username = self.username, password = self.password)        self.response = self.client.get(self.post_new_url)    # 测试成功响应码    def test_view_post_new_success_status_code(self):        self.assertEquals(self.response.status_code, 200)    # 测试链接能正常显示    def test_url_post_new_resolves_view(self):        view = resolve('/blog/post/new/')        self.assertEquals(view.func, post_new)    # 测试页面中是否包含某些链接    def test_view_post_new_contains_navigation_links(self):        logout_url = reverse('logout')        url = reverse('post_new')        response = self.client.get(url)        self.assertContains(response, 'href="{0}"'.format(logout_url))    # 测试表单是否存在    def test_contains_form(self):        form = self.response.context.get('form')        self.assertIsInstance(form, ModelForm)    # 测试表单是否设置跨站防护    def test_csrf(self):        self.assertContains(self.response, 'csrfmiddlewaretoken')    # 测试表单组件是否存在    def test_form_inputs(self):        self.assertContains(self.response, '<input', 2)        self.assertContains(self.response, '<textarea', 1)    # 测试表单提交后的重定向链接    def test_redirection(self):        response = self.client.post(            self.post_new_url,            {                "title": "test title",                "text" : "test text",            }        )        post_detail_url = reverse('post_detail', kwargs = {'pk': int(self.post.pk) + 1})        self.assertRedirects(response, post_detail_url)