# coding=utf-8# @author   ：迷心兔# time      ：2019/11/10from django.test import TestCasefrom django.urls import resolve, reversefrom django.utils import timezonefrom ..models import Postfrom ..views import post_detailfrom django.contrib.auth.models import User# 测试详情页面class DetailTests(TestCase):    def setUp(self):        self.username = "mi"        self.password = "123456"        self.user = User.objects.create_user(username = self.username, password = self.password)        self.post = Post.objects.create(            author = self.user,            title = "test title",            text = "test text",            created_date = timezone.now( ),            published_date = timezone.now( ),        )        self.post_detail_url = reverse('post_detail', kwargs = {'pk': self.post.pk})# 没有登陆的测试class NotLoginHomeTests(DetailTests):    def setUp(self):        super( ).setUp( )        self.response = self.client.get(self.post_detail_url)    # 测试成功响应码    def test_view_post_detail_success_status_code(self):        response = self.client.get(self.post_detail_url)        self.assertEquals(response.status_code, 200)    # 测试失败响应码    def test_view_post_detail_not_found_status_code(self):        url = reverse('post_detail', kwargs = {'pk': 99})        response = self.client.get(url)        self.assertEquals(response.status_code, 404)    # 测试链接能正常显示    def test_url_post_detail_resolves_view(self):        view = resolve('/blog/post/1/')        self.assertEquals(view.func, post_detail)    # 测试页面中是否包含某些链接    def test_view_post_detail_contains_navigation_links(self):        login_url = reverse('login')        response = self.client.get(self.post_detail_url)        self.assertContains(response, 'href="{0}"'.format(login_url))# 成功登陆的测试class LoginSuccessNewTests(DetailTests):    def setUp(self):        super( ).setUp( )        self.client.login(username = self.username, password = self.password)        self.response = self.client.get(self.post_detail_url)    # 测试成功响应码    def test_view_post_detail_success_status_code(self):        response = self.client.get(self.post_detail_url)        self.assertEquals(response.status_code, 200)    # 测试失败响应码    def test_view_post_detail_not_found_status_code(self):        url = reverse('post_detail', kwargs = {'pk': 99})        response = self.client.get(url)        self.assertEquals(response.status_code, 404)    # 测试链接能正常显示    def test_url_post_detail_resolves_view(self):        view = resolve('/blog/post/1/')        self.assertEquals(view.func, post_detail)    # 测试页面中是否包含某些链接    def test_view_post_detail_contains_navigation_links(self):        logout_url = reverse('logout')  # 退出链接        post_new_url = reverse('post_new')  # 新建链接        self.assertContains(self.response, 'href="{0}"'.format(logout_url))        self.assertContains(self.response, 'href="{0}"'.format(post_new_url))